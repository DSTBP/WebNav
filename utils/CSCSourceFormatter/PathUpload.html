<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>文件选择器</title>
    <style type="text/css">
    * {
        margin: 0;
        padding: 0;
    }

    .file {
        vertical-align: top;
        position: relative;
        display: inline-block;
        background: #D0EEFF;
        border: 1px solid #99D3F5;
        border-radius: 4px;
        padding: 4px 12px;
        overflow: hidden;
        color: #1E88C7;
        text-decoration: none;
        text-indent: 0;
        line-height: 20px;
    }

    .file input {
        position: absolute;
        font-size: 100px;
        right: 0;
        top: 0;
        opacity: 0;
    }

    .file:hover {
        background: #AADFFD;
        border-color: #78C3F3;
        color: #004974;
        text-decoration: none;
    }

    #dllList {
        margin: auto;
        display: inline-block;
        border-collapse: collapse;
    }

    #dllList th,
    td {
        width: 200px;
        border: 1px solid #98bf21;
        font-size: 1em;
        text-align: right;
        padding: 3px 7px 2px 7px;
    }

    #dllList th {
        font-size: 1.1em;
        text-align: left;
        padding-top: 5px;
        padding-bottom: 4px;
        background-color: #A7C942;
        color: #ffffff;
    }

    #dllList tr:nth-child(even) {
        color: #000000;
        background-color: #EAF2D3;
    }
    
    .filter-container {
        margin: 10px 0;
        display: flex;
        align-items: center;
    }
    
    .filter-container label {
        margin-right: 5px;
    }
    
    .filter-container input {
        padding: 3px 5px;
        border: 1px solid #99D3F5;
        border-radius: 3px;
        margin-right: 5px;
    }
    
    .filter-container button {
        padding: 3px 10px;
        background: #D0EEFF;
        border: 1px solid #99D3F5;
        border-radius: 3px;
        cursor: pointer;
    }
    
    .filter-container button:hover {
        background: #AADFFD;
    }
    </style>
    <script type="text/javascript">
    // 保存当前选择的文件，用于重新筛选
    let selectedFiles = [];
    
    function fileChange(that) {
        // 保存选择的文件列表
        selectedFiles = Array.from(that.files);
        
        // 获取当前输入的文件后缀
        const fileExt = document.getElementById('fileExt').value.trim() || '.dll';
        
        // 筛选并显示文件
        filterAndDisplayFiles(fileExt);
    }
    
    function filterAndDisplayFiles(ext) {
        if (!selectedFiles || selectedFiles.length === 0) {
            alert("请先选择文件");
            return;
        }
        
        // 构建正则表达式，支持多个后缀（用逗号分隔）
        const exts = ext.split(',').map(e => e.trim().replace(/^\./, '')).filter(e => e);
        if (exts.length === 0) {
            alert("请输入有效的文件后缀");
            return;
        }
        
        // 构建正则表达式
        const extRegex = new RegExp(`\\.(${exts.join('|')})$`, 'i');
        
        // 筛选文件
        const filteredFiles = selectedFiles.filter(file => extRegex.test(file.name));
        
        if (filteredFiles.length === 0) {
            alert(`没有找到后缀为 ${ext} 的文件`);
            return;
        }
        
        // 构建JSON
        let filesJson = '[';
        for (let i = 0; i < filteredFiles.length; i++) {
            let name = filteredFiles[i].name;
            let size = Math.round(filteredFiles[i].size / 1024) + "K";
            filesJson += `{"name":"${name}","size":"${size}"},`;
        }
        filesJson = filesJson.slice(0, -1) + "]";
        
        // 创建表格
        createTable(filesJson);
    }

    function createTable(jsonStr) {
        var obj = JSON.parse(jsonStr);
        var tableObject = document.getElementById('dllList');
        
        // 清空表格中的现有数据行（保留表头）
        while (tableObject.rows.length > 1) {
            tableObject.deleteRow(1);
        }
        
        for (var i in obj) {
            let TableRow = tableObject.insertRow();
            let fileName = TableRow.insertCell(0);
            fileName.innerHTML = obj[i].name;
            let fileSize = TableRow.insertCell(1);
            fileSize.innerHTML = obj[i].size;
        }
    }
    </script>
</head>

<body>
    <div class="filter-container">
        <label for="fileExt">文件后缀:</label>
        <input type="text" id="fileExt" placeholder="例如: .dll, .exe" value=".dll">
        <button onclick="filterAndDisplayFiles(document.getElementById('fileExt').value)">筛选</button>
    </div>
    
    <table id="dllList">
        <thead>
            <tr>
                <th>文件名</th>
                <th>大小(误差±1K)</th>
            </tr>
        </thead>
    </table>
    
    <a href="javascript:;" class="file">选择文件
        <input type="file" webkitdirectory directory onchange="fileChange(this);" />
    </a>
</body>

</html>